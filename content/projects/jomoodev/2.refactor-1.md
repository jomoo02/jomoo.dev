---
title: jomoo.dev 리팩터링-1 
description: 블로그 사이트 리팩터링 하기 첫 번째
date: 2023/12/25
---

# jomoo.dev 리팩터링-1
<div class="flex justify-end text-sm">2023/12/25</div>

### intro
이전 단어장 프로젝트의 리팩터링을 마무리하고, 리팩터링에 재미가 붙어, jomoo.dev 프로젝트의 코드도 리팩터링하려 한다. 이전에 기능 구현만을 우선했기에 훑어만 봐도 리팩터링할게 많아 보인다.  
일단 pinia store의 코드부터 리팩터링하겠다.  

### 이전 pinia store 구조
<img width="209" alt="스크린샷 2023-12-25 오후 3 13 06" src="https://github.com/jomoo02/jomoo.dev/assets/86420174/019bd152-1600-4965-955d-cbe0f15b0e2d">

어떤 레이아웃을 띄울지 정하는 상태와, 모달 상태를 다루는 `mainState.js`와 작성한 포스트들의 상태를 관리하는 `postData.js` 두 개의 저장소가 있다. 저장소의 구조와 네이밍 등을 변경하려 한다.

#### `mainState.js`

```js
import { defineStore } from 'pinia';

export const useMainStateStore = defineStore('mainState', {
  state: () => ({
    defaultLayoutIdx: 0,
    modalCheck: false,
  }),
});

```

리팩터링 전 `mainState` 저장소
우선 해당 프로젝트에 pinia store는 option store의 형태다. pinia를 몇 번 사용하다보니, option store 보다는 setup store 형태가 더 사용하기 편했다. vue의 composition api와 script setup 방식과 유사해 이질감이 적기 떄문인 거 같다.  
따라서 pinia store의 문법을 setup store로 변경하겠다.

또한, 현재 해당 스토어에서는 상태만을 저장하고, 해당 상태를 외부에서 다루게 한다.  
외부에서는 상태를 함수 호출을 통해 간접적으로 변경시키고, 내부에서 직접 상태를 변경하는 것이 상태에 대한 책임에 집중시켜 예측 가능성 및 유지 보수성도 향상된다고 생각한다. 따라서 상태에 대한 조작을 스토어에서 하도록 변경하려한다.  

마지막으로, 레이아웃을 정하는 상태와 modal 상태는 서로 다른 기능이기 때문에 기능에 따라 스토어를 분리하는 게 적합하다고 생각한다. 레이아웃에 관련된 스토어를 카테고리로 명명해 `categoriesStore.js`로,
modal과 관련된 스토어를 `modalStore`로 분리하겠다.  

#### `default.vue`

```vue
<template>
  <div class="max-h-full">
    <div class="fixed top-0 z-20 w-full bg-white">
      <header class="border-b-[1px] border-b-gray-300">
        <div class="mx-auto max-w-7xl px-6 sm:px-4 lg:px-8 relative w-full">
          <nav
            class="grid grid-cols-6 min-h-16 max-h-20 items-center h-16 lg:h-20 justify-center"
          >
            <div
              class="col-span-1 flex justify-start cursor-pointer md:hidden"
              @click="hiddenMenuOperation"
            >
              <ListIcon />
            </div>
            <div
              class="flex justify-center md:justify-start col-span-4 md:col-span-1"
            >
              <div class="text-2xl font-extrabold text-stone-800">
                <NuxtLink to="/" @click="home()">JOMOO.DEV</NuxtLink>
              </div>
            </div>
            <ul
              class="hidden md:flex justify-center gap-x-10 col-span-4 font-semibold"
            >
              <li>
                <NuxtLink to="/note/programmers">
                  <div
                    class="flex p-1.5 text-zinc-600 border-b-[2px] border-b-white hover:text-emerald-500"
                    :class="mainStore.defaultLayoutIdx === 1 ? 'link' : ''"
                    @click="menuSelectNote()"
                  >
                    Note
                  </div>
                </NuxtLink>
              </li>
              <li>
                <NuxtLink to="/projects/vocabularynote">
                  <div
                    class="flex p-1.5 text-zinc-600 border-b-[2px] border-b-white hover:text-emerald-500"
                    :class="mainStore.defaultLayoutIdx === 2 ? 'link' : ''"
                    @click="menuSelectProjects()"
                  >
                    Projects
                  </div>
                </NuxtLink>
              </li>
              <li>
                <div class="p-1.5 cursor-not-allowed text-zinc-600">etc</div>
              </li>
            </ul>
          </nav>
        </div>
      </header>
    </div>
    <div class="mt-16 pt-2.5 md:mt-32">
      <slot />
    </div>
    <Teleport to="body">
      <div
        v-if="mainStore.modalCheck === true"
        class="fixed inset-0 z-[999] mt-16 w-full bg-white"
      >
        <div class="flex pt-2.5">
          <ul
            class="flex-col px-4 justify-center gap-x-10 col-span-4 font-semibold"
          >
            <li>
              <NuxtLink to="/note/programmers">
                <div
                  class="flex p-1.5 text-zinc-600 hover:text-emerald-500"
                  :class="mainStore.defaultLayoutIdx === 1 ? 'link_md' : ''"
                  @click="menuSelectNote()"
                >
                  Note
                </div>
              </NuxtLink>
            </li>
            <li>
              <NuxtLink to="/projects/vocabularynote">
                <div
                  class="flex p-1.5 text-zinc-600 hover:text-emerald-500"
                  :class="mainStore.defaultLayoutIdx === 2 ? 'link_md' : ''"
                  @click="menuSelectProjects()"
                >
                  Projects
                </div>
              </NuxtLink>
            </li>
            <li class="p-1.5 cursor-not-allowed text-zinc-600">etc</li>
          </ul>
        </div>
      </div>
    </Teleport>
  </div>
</template>

<script setup>
import { useMainStateStore } from '~~/store/mainState';

const mainStore = useMainStateStore();
const route = useRoute();
const routes = route.path.split('/');

if (routes[1] === 'note') {
  mainStore.defaultLayoutIdx = 1;
} else if (routes[1] === 'projects') {
  mainStore.defaultLayoutIdx = 2;
}

function overflowYRemove() {
  mainStore.modalCheck = false;
  if (process.client) {
    document.body.classList.remove('overflow-y-hidden');
  }
}

function home() {
  // mainStore.defaultLayoutIdx = 0;
  overflowYRemove();
}

function menuSelectNote() {
  // mainStore.defaultLayoutIdx = 1;
  overflowYRemove();
}

function menuSelectProjects() {
  // mainStore.defaultLayoutIdx = 2;
  overflowYRemove();
}

function hiddenMenuOperation() {
  if (mainStore.modalCheck === true) {
    overflowYRemove();
  } else {
    mainStore.modalCheck = true;
    if (process.client) {
      document.body.classList.add('overflow-y-hidden');
    }
  }
}
</script>
<style scoped>
.link {
  border-bottom-width: 2px;
  --tw-border-opacity: 1;
  border-bottom-color: rgb(5 150 105 / var(--tw-border-opacity));
  color: #047857;
}
.link_md {
  color: #047857;
}
</style>
```

현재 기본 레이아웃 컴포넌트인 `default.vue`  
해당 컴포넌트 파일의 코드가 길기에 분리할 수 있는 기능들을 분리하려한다. 가볍게 봤을 때는 화면 크기가 작을 때(width가 768px 보다 작을 때) 렌더링되는 <Teleport>로 감싸진 부분은 따로 분리하기 쉬울 거 같다.  
또, script setup 내 코드들을 컴포저블을 이용해 분리할 수 있을거 같다.

### 리팩터링 후 코드
#### `constants/categories.js`
```js
const HOME = 'home';
const NOTE = 'note';
const PROJECTS = 'projects';

export { HOME, NOTE, PROJECTS };

```

#### `categoriesStore.js`
```js
import { defineStore } from 'pinia';
import { HOME, NOTE, PROJECTS } from '../constants/categories';

export const useCategoriesStore = defineStore('categories', () => {
  const categoriesState = ref(HOME);

  function selectHome() {
    categoriesState.value = HOME;
  }

  function selectNote() {
    categoriesState.value = NOTE;
  }

  function selectProject() {
    categoriesState.value = PROJECTS;
  }

  return {
    categoriesState,
    selectHome,
    selectNote,
    selectProject,
  };
});
```

레이아웃 관련 상태를 카테고리로 명명한 뒤, 해당 스토어에서만 카테고리 상태를 직접적으로 변경시킬 수 있게 했다. 또한 카테고리 목록들을 여러 곳에서 공유할 수 있게 상수 파일로 분리했다.
