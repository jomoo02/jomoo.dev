---
title: 포스트 목차 기능 추가
description: 포스트 오른쪽에 목차 테이블 추가하기
date: 2024/02/12
category: projects
detail: jomoodev
---

# 포스트 오른쪽에 목차 테이블 추가하기
::creation-date{:date="date"}
::

## intro
이번에는 포스트 페이지에 목차를 추가하려 한다. 구현하려는 기능으로는
1. h2 태그와 h3 태그로 목차의 항목을 알린다.
2. h3 태그는 h2 태그보다 왼쪽에 위치 시켜 소제목임을 알린다.  
3. 목차에 있는 항목(주제, 제목)을 클릭하면 해당 항목으로 이동한다.
4. 현재 화면의 위치에 따라 목차의 항목을 스타일링 한다.  

위 기능을 하나의 컴포저블 함수(`useTableOfContent.js`)와 하나의 컴포넌트(`TableOfContent.vue`)로 구현하겠다.

## 1. h2 태그와 h3 태그로 목차의 항목을 알리기
현재 작성한 포스트들은 h2 태그를 메인 섹션으로, h3 태그를 메인 섹션의 서브 섹션으로 구분하고 있다.  
h2 태그와 h3 태그를 `document.getElementsByTagName`를 이용해 갖고 와 항목들을 다룬다.

`useTableOfContent.js`
```js
const pickSections = () => {
  const targetTags = [
    { targetTag: 'h3', margin: 150 },
    { targetTag: 'h4', margin: 160 },
  ];

  return targetTags
    .reduce((array, { targetTag, margin }) => {
      const absoluteTops = Array.from(document.getElementsByTagName(targetTag)).map((tag) => {
        const absoluteTop = window.screenY + tag.getBoundingClientRect().top - margin;
        return {
          absoluteTop: Math.round(absoluteTop),
          tag: targetTag,
          text: tag.innerText,
          id: tag.id,
          sub: [],
          active: false,
        };
      });
      return [...array, ...absoluteTops];
    }, [])
    .sort((a, b) => a.absoluteTop - b.absoluteTop);
};
```

컴포저블 함수 `useTableOfContent.js`에서의 h3 태그와 h4 태그를 갖고 와 필요한 정보를 고른 뒤, 절대 높이에 따라 정렬해 반환하는 함수 `pickSections`  

맨 위에 선언한 배열 `tagetTags`는 가지고 올 태그와 해당 태그의 margin 값을 저장한다. 여기서 margin 값은, 태그의 절대좌표를 이용해 현재 어떤 section 인지를 확인할 때 헤더의 높이를 고려하기 위한 값이다. 이 값을 태그의 절대좌표에서 빼 태그의 절대좌표보다 위(태그의 좌표보다 이전 좌표에서)에서 좌표를 확인함으로서 헤더와 태그가 겹쳐지기 전에 태그의 섹션에 들어왔음을 체크할 수 있게 한다.  


